# ๐ง ุฅุตูุงุญ ูุดุงูู ุงุณุชูุฑุงุฏ MANPOWER

## โ ุงููุดุงูู ุงูุชู ุชู ุฅุตูุงุญูุง

### 1. **ุตููู ุจุฏูู PROJECT CODE**
**ุงููุดููุฉ:** ูุงูุช ุชุธูุฑ ุชุญุฐูุฑุงุช ุนู ุตููู ููููุฏุฉ PROJECT CODEุ ููููุง ูุงูุช ุชูุณุชูุฑุฏ ุฑุบู ุฐูู.

**ุงูุญู:**
- โ ุงูุขู ูุชู **ุชุตููุฉ** ุงูุตููู ุจุฏูู PROJECT CODE ูุจู ุงูุงุณุชูุฑุงุฏ
- โ ูุชู ุชุฌุงูู ุงูุตููู ุงูุชู ุชุญุชูู ุนูู `#N/A` ุฃู `N/A` ูู PROJECT CODE
- โ ุฑุณุงูุฉ ูุงุถุญุฉ ูููุณุชุฎุฏู ุจุนุฏุฏ ุงูุตููู ุงูุชู ุชู ุชุฎุทููุง
- โ ุฅุฐุง ูุงูุช ุฌููุน ุงูุตููู ุจุฏูู PROJECT CODEุ ูุชู ุฅููุงู ุงูุงุณุชูุฑุงุฏ ูุน ุฑุณุงูุฉ ุฎุทุฃ ูุงุถุญุฉ

### 2. **ุฎุทุฃ 403 Forbidden ุนูุฏ ุงูุญุฐู (Replace Mode)**
**ุงููุดููุฉ:** ุนูุฏ ูุญุงููุฉ ุงุณุชูุฑุงุฏ ุงูุจูุงูุงุช ูู ูุถุน "Replace"ุ ูุงู ูุญุฏุซ ุฎุทุฃ 403 ูุฃู RLS policy ุชุณูุญ ููุท ููู admins ุจุญุฐู ุงูุจูุงูุงุช.

**ุงูุญู:**
- โ ุชู ุฅูุดุงุก function `clear_manpower_data()` ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
- โ ูุฐู ุงูู function ุชุณูุญ ูููุณุชุฎุฏููู ุงููุณุฌููู ุจุญุฐู ุงูุจูุงูุงุช (ููุงุณุชูุฑุงุฏ ุงูุฌุฏูุฏ)
- โ ุชู ุชุญุฏูุซ `clearTableData()` ูุงุณุชุฎุฏุงู ูุฐู ุงูู function ููุฌุฏูู MANPOWER
- โ ุฅุฐุง ูุดูุช ุงูู functionุ ูุชู ุงุณุชุฎุฏุงู ุทุฑููุฉ fallback

## ๐ ุงูุฎุทูุงุช ุงููุทููุจุฉ

### 1. ุชุญุฏูุซ ูุงุนุฏุฉ ุงูุจูุงูุงุช
ูู ุจุชุดุบูู SQL script ุงููุญุฏุซ:

```sql
-- ุงูุณุฎ ูุญุชูู Database/create-manpower-table.sql
-- ูุงูุตูู ูู Supabase SQL Editor
-- ุงุถุบุท Run
```

**ุงูููู:** `Database/create-manpower-table.sql`

**ุงูุฌุฒุก ุงูุฌุฏูุฏ:**
```sql
-- ุฏุงูุฉ ูุญุฐู ุฌููุน ุจูุงูุงุช MANPOWER (ููุงุณุชุฎุฏุงู ูู ูุถุน Replace)
CREATE OR REPLACE FUNCTION clear_manpower_data()
RETURNS TABLE (
  deleted_count BIGINT,
  success BOOLEAN,
  message TEXT
) AS $$
DECLARE
  v_count BIGINT;
BEGIN
  -- ุญุฐู ุฌููุน ุงูุจูุงูุงุช
  DELETE FROM public."CCD - MANPOWER";
  
  GET DIAGNOSTICS v_count = ROW_COUNT;
  
  RETURN QUERY
  SELECT 
    v_count AS deleted_count,
    TRUE AS success,
    format('Successfully deleted %s records from MANPOWER table', v_count) AS message;
END;
$$ LANGUAGE plpgsql SECURITY DEFINER;

-- Grant execute permission to authenticated users
GRANT EXECUTE ON FUNCTION clear_manpower_data() TO authenticated;
```

### 2. ุฅุนุงุฏุฉ ูุญุงููุฉ ุงูุงุณุชูุฑุงุฏ
ุจุนุฏ ุชุดุบูู SQL script:
1. ุงูุชุญ Cost Control > MANPOWER
2. ุงุถุบุท Import
3. ุงุฎุชุฑ ุงูููู
4. ุงุฎุชุฑ Import Mode (Append ุฃู Replace)
5. ุงุถุบุท Import

## ๐ฏ ุงูุชุญุณููุงุช

### ูุจู ุงูุฅุตูุงุญ:
- โ ุตููู ุจุฏูู PROJECT CODE ูุงูุช ุชูุณุชูุฑุฏ
- โ ุฎุทุฃ 403 ุนูุฏ ูุญุงููุฉ Replace
- โ ุฑุณุงุฆู ุชุญุฐูุฑูุฉ ููุท ุจุฏูู ุชุตููุฉ

### ุจุนุฏ ุงูุฅุตูุงุญ:
- โ ุตููู ุจุฏูู PROJECT CODE ูุชู ุชุฎุทููุง ุชููุงุฆูุงู
- โ Replace mode ูุนูู ุจุดูู ุตุญูุญ
- โ ุฑุณุงุฆู ูุงุถุญุฉ ุนู ุนุฏุฏ ุงูุตููู ุงููุณุชูุฑุฏุฉ ูุงููุชุฎุทุงุฉ
- โ ูุนุงูุฌุฉ ุฃุฎุทุงุก ุฃูุถู ูุน fallback

## ๐ ูุซุงู ุนูู ุงูุฑุณุงุฆู

### ุนูุฏ ุงูุงุณุชูุฑุงุฏ ุงููุงุฌุญ:
```
โ Successfully imported 107,880 records (4 rows skipped - missing PROJECT CODE)
```

### ุนูุฏ ูุดู ุงูุงุณุชูุฑุงุฏ:
```
โ No valid rows found. All rows are missing PROJECT CODE (required field).
```

## ๐ ููุงุญุธุงุช

1. **PROJECT CODE ูุทููุจ:** ูุง ูููู ุงุณุชูุฑุงุฏ ุตู ุจุฏูู PROJECT CODE
2. **Replace Mode:** ูุญุฐู ุฌููุน ุงูุจูุงูุงุช ุงููุฏููุฉ ูุจู ุงูุงุณุชูุฑุงุฏ ุงูุฌุฏูุฏ
3. **Append Mode:** ูุถูู ุงูุจูุงูุงุช ุงูุฌุฏูุฏุฉ ุฅูู ุงูุจูุงูุงุช ุงูููุฌูุฏุฉ
4. **Function Security:** ุงูู function `clear_manpower_data()` ุชุณุชุฎุฏู `SECURITY DEFINER` ูุชูููู ุงููุณุชุฎุฏููู ูู ุงูุญุฐู

---

**ุชุงุฑูุฎ ุงูุชุญุฏูุซ:** ุฏูุณูุจุฑ 2024  
**ุงูุญุงูุฉ:** โ ุชู ุงูุฅุตูุงุญ
