# ๐ ุฌุฏูู CCD - MANPOWER

## ูุธุฑุฉ ุนุงูุฉ

ุฌุฏูู **CCD - MANPOWER** ูู ุฌุฏูู ููุณู Cost Control ูุชุฎุฒูู ุจูุงูุงุช ุงูููู ุงูุนุงููุฉ ูุงูุชูุงููู ูููุดุงุฑูุน.

## ุงูุจููุฉ

### ุงูุฃุนูุฏุฉ

| ุงูุนููุฏ | ุงูููุน | ุงููุตู | ูุทููุจ |
|--------|-------|-------|-------|
| `id` | UUID | ุงููุนุฑู ุงููุฑูุฏ ููุณุฌู | โ |
| `Column 1` | TEXT | ุงูุนููุฏ ุงูุฃูู (ุฅุถุงูู) | โ |
| `PROJECT CODE` | TEXT | ุฑูุฒ ุงููุดุฑูุน | โ |
| `LABOUR CODE` | TEXT | ุฑูุฒ ุงูุนุงูู/ุงูููุธู | โ |
| `Designation` | TEXT | ุงููุณูู ุงููุธููู | โ |
| `START` | TEXT | ุชุงุฑูุฎ ุงูุจุฏุก | โ |
| `FINISH` | TEXT | ุชุงุฑูุฎ ุงูุงูุชูุงุก | โ |
| `OVERTIME` | TEXT | ุณุงุนุงุช ุงูุนูู ุงูุฅุถุงููุฉ | โ |
| `Total Hours` | NUMERIC(10,2) | ุฅุฌูุงูู ุงูุณุงุนุงุช | โ |
| `Cost` | NUMERIC(15,2) | ุงูุชูููุฉ (ุจุงูุนููุฉ ุงููุญููุฉ) | โ |
| `created_at` | TIMESTAMP | ุชุงุฑูุฎ ุงูุฅูุดุงุก | โ |
| `updated_at` | TIMESTAMP | ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ | โ |
| `created_by` | UUID | ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃ ุงูุณุฌู | โ |

## ุงูุชุซุจูุช

### ุงูุฎุทูุฉ 1: ุชุดุบูู SQL Script

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู **SQL Editor**
3. ุงูุณุฎ ูุญุชูู ููู `create-manpower-table.sql`
4. ุงูุตูู ูู SQL Editor
5. ุงุถุบุท **Run** ุฃู **Execute**

### ุงูุฎุทูุฉ 2: ุงูุชุญูู ูู ุงูุฅูุดุงุก

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุชุ ุชุญูู ูู:

```sql
-- ุงูุชุญูู ูู ูุฌูุฏ ุงูุฌุฏูู
SELECT * FROM information_schema.tables 
WHERE table_name = 'CCD - MANPOWER';

-- ุนุฑุถ ุงูุฃุนูุฏุฉ
SELECT column_name, data_type 
FROM information_schema.columns
WHERE table_name = 'CCD - MANPOWER';
```

## ุงูุฃูุงู (RLS Policies)

### ุงูุตูุงุญูุงุช

- **SELECT (ูุฑุงุกุฉ)**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู ูููููู ูุฑุงุกุฉ ุงูุจูุงูุงุช
- **INSERT (ุฅุถุงูุฉ)**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู ูููููู ุฅุถุงูุฉ ุจูุงูุงุช
- **UPDATE (ุชุญุฏูุซ)**: ุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู ูููููู ุชุญุฏูุซ ุงูุจูุงูุงุช
- **DELETE (ุญุฐู)**: ููุท Admins ูููููู ุญุฐู ุงูุจูุงูุงุช

## Indexes ููุฃุฏุงุก

ุชู ุฅูุดุงุก ุงูููุงุฑุณ ุงูุชุงููุฉ ูุชุญุณูู ุงูุฃุฏุงุก:

- `idx_manpower_project_code` - ููุจุญุซ ุงูุณุฑูุน ุญุณุจ Project Code
- `idx_manpower_labour_code` - ููุจุญุซ ุงูุณุฑูุน ุญุณุจ Labour Code
- `idx_manpower_designation` - ููุจุญุซ ุงูุณุฑูุน ุญุณุจ Designation
- `idx_manpower_start` - ููุจุญุซ ุญุณุจ ุชุงุฑูุฎ ุงูุจุฏุก
- `idx_manpower_finish` - ููุจุญุซ ุญุณุจ ุชุงุฑูุฎ ุงูุงูุชูุงุก
- `idx_manpower_project_labour` - ููุฑุณ ูุฑูุจ (Project Code + Labour Code)

## Helper Functions

### 1. get_manpower_stats(project_code)

ุงูุญุตูู ุนูู ุฅุญุตุงุฆูุงุช MANPOWER ููุดุฑูุน ูุนูู:

```sql
SELECT * FROM get_manpower_stats('P4110-P');
```

**ุงููุชูุฌุฉ:**
- `total_records`: ุฅุฌูุงูู ุงูุณุฌูุงุช
- `total_hours`: ุฅุฌูุงูู ุงูุณุงุนุงุช
- `total_cost`: ุฅุฌูุงูู ุงูุชูููุฉ
- `unique_labour_codes`: ุนุฏุฏ ุฑููุฒ ุงูุนูุงู ุงููุฑูุฏุฉ
- `unique_designations`: ุนุฏุฏ ุงููุณููุงุช ุงููุธูููุฉ ุงููุฑูุฏุฉ

### 2. get_all_manpower_totals()

ุงูุญุตูู ุนูู ุฅุฌูุงูู ุฅุญุตุงุฆูุงุช MANPOWER ูุฌููุน ุงููุดุงุฑูุน:

```sql
SELECT * FROM get_all_manpower_totals();
```

**ุงููุชูุฌุฉ:**
- `total_records`: ุฅุฌูุงูู ุงูุณุฌูุงุช
- `total_hours`: ุฅุฌูุงูู ุงูุณุงุนุงุช
- `total_cost`: ุฅุฌูุงูู ุงูุชูููุฉ
- `unique_projects`: ุนุฏุฏ ุงููุดุงุฑูุน ุงููุฑูุฏุฉ

## ุงูุงุณุชูุฑุงุฏ ูู CSV

### ุงูุทุฑููุฉ 1: ูู ุฎูุงู ูุงุฌูุฉ ุงูุชุทุจูู

1. ุงูุชุญ ุตูุญุฉ **Cost Control > MANPOWER**
2. ุงุถุบุท ุนูู ุฒุฑ **Import**
3. ุงุฎุชุฑ ููู CSV ุฃู Excel
4. ุฑุงุฌุน ุงููุนุงููุฉ
5. ุงุฎุชุฑ Mode (Append/Replace)
6. ุงุถุบุท **Import**

### ุงูุทุฑููุฉ 2: ูู ุฎูุงู Supabase Dashboard

1. ุงูุชุญ Supabase Dashboard
2. ุงุฐูุจ ุฅูู **Table Editor**
3. ุงุฎุชุฑ ุฌุฏูู **CCD - MANPOWER**
4. ุงุถุบุท **Import data**
5. ุงุฎุชุฑ ููู CSV
6. ุงุชุจุน ุงูุชุนูููุงุช

### ุชูุณูู CSV ุงููุทููุจ

```csv
Column 1,PROJECT CODE,LABOUR CODE,Designation,START,FINISH,OVERTIME,Total Hours,Cost
,P4110-P,L001,Engineer,2024-01-01,2024-01-31,0,160,8000
,P4110-P,L002,Technician,2024-01-01,2024-01-31,10,170,5100
```

**ููุงุญุธุงุช:**
- ุงูุฃุนูุฏุฉ ุงููุทููุจุฉ: `PROJECT CODE`, `LABOUR CODE`, `Designation`
- ูููู ุชุฑู ุงูุฃุนูุฏุฉ ุงูุฃุฎุฑู ูุงุฑุบุฉ
- `Total Hours` ู `Cost` ูุฌุจ ุฃู ุชููู ุฃุฑูุงู

## ุฃูุซูุฉ ุงูุงุณุชุนูุงูุงุช

### ุงูุจุญุซ ุนู ุจูุงูุงุช ูุดุฑูุน ูุนูู

```sql
SELECT * FROM public."CCD - MANPOWER"
WHERE "PROJECT CODE" ILIKE '%P4110%'
ORDER BY "START" DESC;
```

### ุญุณุงุจ ุฅุฌูุงูู ุงูุชูููุฉ ููุดุฑูุน

```sql
SELECT 
  "PROJECT CODE",
  SUM("Total Hours") AS total_hours,
  SUM("Cost") AS total_cost,
  COUNT(*) AS records_count
FROM public."CCD - MANPOWER"
WHERE "PROJECT CODE" = 'P4110-P'
GROUP BY "PROJECT CODE";
```

### ุงูุจุญุซ ุญุณุจ Labour Code

```sql
SELECT * FROM public."CCD - MANPOWER"
WHERE "LABOUR CODE" = 'L001'
ORDER BY "START" DESC;
```

### ุงูุจุญุซ ุญุณุจ ุงููุณูู ุงููุธููู

```sql
SELECT * FROM public."CCD - MANPOWER"
WHERE "Designation" ILIKE '%Engineer%'
ORDER BY "PROJECT CODE", "START";
```

## ุงูุตูุงูุฉ

### ุชูุธูู ุงูุจูุงูุงุช ุงููุฏููุฉ

```sql
-- ุญุฐู ุณุฌูุงุช ุฃูุฏู ูู ุณูุฉ (ูุซุงู)
DELETE FROM public."CCD - MANPOWER"
WHERE created_at < NOW() - INTERVAL '1 year';
```

### ุชุญุฏูุซ ุงูุจูุงูุงุช

```sql
-- ุชุญุฏูุซ ุงูุชูููุฉ ูุณุฌู ูุนูู
UPDATE public."CCD - MANPOWER"
SET "Cost" = 10000,
    updated_at = NOW()
WHERE id = 'uuid-here';
```

## ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ุงููุดููุฉ: ุงูุฌุฏูู ุบูุฑ ููุฌูุฏ

**ุงูุญู:**
1. ุชุฃูุฏ ูู ุชุดุบูู SQL script
2. ุชุญูู ูู ุงุณู ุงูุฌุฏูู (ูุฌุจ ุฃู ูููู `CCD - MANPOWER` ูุน ุงููุณุงูุงุช)

### ุงููุดููุฉ: ูุง ูููู ุฅุถุงูุฉ ุจูุงูุงุช

**ุงูุญู:**
1. ุชุญูู ูู RLS policies
2. ุชุฃูุฏ ูู ุฃูู ูุณุฌู ุฏุฎูู
3. ุชุญูู ูู ุงูุตูุงุญูุงุช ูู ุฌุฏูู `users`

### ุงููุดููุฉ: ุงูุจุญุซ ุจุทูุก

**ุงูุญู:**
1. ุชุญูู ูู ูุฌูุฏ Indexes
2. ุงุณุชุฎุฏู Project Code ูู ุงูุจุญุซ
3. ุฃุถู LIMIT ููุงุณุชุนูุงูุงุช ุงููุจูุฑุฉ

## ุงูุฏุนู

ูููุณุงุนุฏุฉ ุฃู ุงูุงุณุชูุณุงุฑุงุชุ ูุฑุฌู ุงูุชูุงุตู ูุน ูุฑูู ุงูุชุทููุฑ.

---

**ุขุฎุฑ ุชุญุฏูุซ:** ุฏูุณูุจุฑ 2024  
**ุงูุฅุตุฏุงุฑ:** 1.0.0
