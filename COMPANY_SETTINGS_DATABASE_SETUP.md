# ๐ข ุฏููู ุฅุนุฏุงุฏ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช

## ๐ ูุธุฑุฉ ุนุงูุฉ

ุชู ุฅูุดุงุก ูุธุงู ุดุงูู ูุญูุธ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช ุงูุฃุณุงุณูุฉ ุจุฏูุงู ูู localStorage. ูุฐุง ูุถูู:

- โ **ุงููุตูู ุงููุฑูุฒู** - ุฌููุน ุงููุณุชุฎุฏููู ูุฑูู ููุณ ุงูุฅุนุฏุงุฏุงุช
- โ **ุงูุฃูุงู** - ุตูุงุญูุงุช ูุญุฏุฏุฉ ูููุฏูุฑูู ููุท
- โ **ุงูุงุณุชูุฑุงุฑูุฉ** - ุงูุฅุนุฏุงุฏุงุช ูุญููุธุฉ ุญุชู ุจุนุฏ ุฅุนุงุฏุฉ ุชุดุบูู ุงูุชุทุจูู
- โ **ุงูุชุฎุฒูู ุงููุคูุช** - ุฃุฏุงุก ูุญุณู ูุน ุงูุชุฎุฒูู ุงููุคูุช ุงูุฐูู

## ๐๏ธ ูููู ูุงุนุฏุฉ ุงูุจูุงูุงุช

### ุฌุฏูู `company_settings`

```sql
CREATE TABLE company_settings (
    id UUID DEFAULT gen_random_uuid() PRIMARY KEY,
    company_name TEXT NOT NULL DEFAULT 'AlRabat RPF',
    company_slogan TEXT NOT NULL DEFAULT 'Masters of Foundation Construction',
    company_logo_url TEXT,
    created_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    updated_at TIMESTAMP WITH TIME ZONE DEFAULT NOW(),
    created_by UUID REFERENCES auth.users(id),
    updated_by UUID REFERENCES auth.users(id)
);
```

### ุงูุญููู:

- **`id`** - ูุนุฑู ูุฑูุฏ ููุณุฌู
- **`company_name`** - ุงุณู ุงูุดุฑูุฉ (ุงูุชุฑุงุถู: "AlRabat RPF")
- **`company_slogan`** - ุดุนุงุฑ ุงูุดุฑูุฉ (ุงูุชุฑุงุถู: "Masters of Foundation Construction")
- **`company_logo_url`** - ุฑุงุจุท ููุฌู ุงูุดุฑูุฉ (ุงุฎุชูุงุฑู)
- **`created_at`** - ุชุงุฑูุฎ ุงูุฅูุดุงุก
- **`updated_at`** - ุชุงุฑูุฎ ุขุฎุฑ ุชุญุฏูุซ
- **`created_by`** - ุงููุณุชุฎุฏู ุงูุฐู ุฃูุดุฃ ุงูุณุฌู
- **`updated_by`** - ุงููุณุชุฎุฏู ุงูุฐู ุญุฏุซ ุงูุณุฌู ุขุฎุฑ ูุฑุฉ

## ๐ ุณูุงุณุงุช ุงูุฃูุงู (RLS)

### ุตูุงุญูุงุช ุงููุฑุงุกุฉ:
- โ **ุฌููุน ุงููุณุชุฎุฏููู ุงููุณุฌููู** ูููููู ูุฑุงุกุฉ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ

### ุตูุงุญูุงุช ุงูุชุนุฏูู:
- โ **ุงููุฏูุฑูู ููุท** ูููููู ุชุนุฏูู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
- โ **ุงููุณุชุฎุฏููู ุงูุขุฎุฑูู** ูุง ูููููู ุงูุชุนุฏูู

## ๐๏ธ ุงูุฏูุงู ุงููุณุงุนุฏุฉ

### 1. `get_company_settings()`
```sql
SELECT * FROM get_company_settings();
```
- ุฌูุจ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ ุงูุญุงููุฉ
- ุชุฑุฌุน ุฃุญุฏุซ ุณุฌู

### 2. `update_company_settings(company_name, company_slogan, company_logo_url)`
```sql
SELECT update_company_settings('New Company', 'New Slogan', 'logo_url');
```
- ุชุญุฏูุซ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
- ูุชุงุญ ูููุฏูุฑูู ููุท
- ุชุฑุฌุน `true` ุนูุฏ ุงููุฌุงุญ

## ๐ ุงููููุงุช ุงููุถุงูุฉ/ุงููุญุฏุซุฉ

### ูููุงุช ุฌุฏูุฏุฉ:
1. **`Database/company-settings-table.sql`** - ุณูุฑูุจุช ุฅูุดุงุก ุงูุฌุฏูู ูุงูุฏูุงู
2. **`lib/companySettings.ts`** - ููุชุจุฉ ุงูุชุนุงูู ูุน ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
3. **`components/settings/CompanySettings.tsx`** - ูููู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ
4. **`COMPANY_SETTINGS_DATABASE_SETUP.md`** - ูุฐุง ุงูุฏููู

### ูููุงุช ูุญุฏุซุฉ:
1. **`lib/supabase.ts`** - ุฅุถุงูุฉ `COMPANY_SETTINGS` ุฅูู `TABLES`
2. **`components/dashboard/ModernSidebar.tsx`** - ูุฑุงุกุฉ ุงูุฅุนุฏุงุฏุงุช ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช
3. **`app/(authenticated)/settings/page.tsx`** - ุฅุถุงูุฉ ุชุจููุจ ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ

## ๐ ุฎุทูุงุช ุงูุฅุนุฏุงุฏ

### 1. ุชุดุบูู ุณูุฑูุจุช ูุงุนุฏุฉ ุงูุจูุงูุงุช
```bash
# ูู Supabase SQL Editor
# ุชุดุบูู ูุญุชูู ููู: Database/company-settings-table.sql
```

### 2. ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏ
```sql
-- ุงูุชุญูู ูู ุฅูุดุงุก ุงูุฌุฏูู
SELECT * FROM company_settings;

-- ุงูุชุญูู ูู ุงูุฏูุงู
SELECT * FROM get_company_settings();

-- ุงูุชุญูู ูู ุงูุณูุงุณุงุช
SELECT * FROM pg_policies WHERE tablename = 'company_settings';
```

### 3. ุฅุฏุฑุงุฌ ุฅุนุฏุงุฏุงุช ุงูุชุฑุงุถูุฉ
```sql
-- ุณูุชู ุฅุฏุฑุงุฌูุง ุชููุงุฆูุงู ุนูุฏ ุชุดุบูู ุงูุณูุฑูุจุช
INSERT INTO company_settings (company_name, company_slogan, created_by, updated_by)
VALUES (
    'AlRabat RPF',
    'Masters of Foundation Construction',
    (SELECT id FROM auth.users LIMIT 1),
    (SELECT id FROM auth.users LIMIT 1)
);
```

## ๐ป ุงุณุชุฎุฏุงู ุงููุธุงู

### ูู ุงูููุฏ:

```typescript
import { getCompanySettings, updateCompanySettings } from '@/lib/companySettings'

// ุฌูุจ ุงูุฅุนุฏุงุฏุงุช
const settings = await getCompanySettings()

// ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช (ูููุฏูุฑูู ููุท)
const result = await updateCompanySettings(
  'New Company Name',
  'New Company Slogan',
  'https://example.com/logo.png'
)
```

### ูู ุงููุงุฌูุฉ:
1. ุงุฐูุจ ุฅูู **Settings** โ **Company Settings**
2. ุนุฏู ุงุณู ุงูุดุฑูุฉ ุฃู ุงูุดุนุงุฑ ุฃู ุงูููุฌู
3. ุงุถุบุท **ุญูุธ ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช**
4. ุณุชุธูุฑ ุงูุชุบููุฑุงุช ููุฑุงู ูู ุงูุดุฑูุท ุงูุฌุงูุจู

## ๐ ุงูุชุฎุฒูู ุงููุคูุช

- **ูุฏุฉ ุงูุชุฎุฒูู ุงููุคูุช**: 5 ุฏูุงุฆู
- **ูุณุญ ุงูุชุฎุฒูู ุงููุคูุช**: ุนูุฏ ุชุญุฏูุซ ุงูุฅุนุฏุงุฏุงุช
- **ุงูุงุณุชุฎุฏุงู**: `getCachedCompanySettings()` ููุญุตูู ุนูู ุฃุฏุงุก ูุญุณู

## ๐ก๏ธ ุงูุฃูุงู

### ุงูุชุญูู ูู ุงูุตูุงุญูุงุช:
```typescript
const canEdit = await canUpdateCompanySettings()
if (!canEdit) {
  // ุนุฑุถ ุฑุณุงูุฉ ุฎุทุฃ
}
```

### ูู ูุงุนุฏุฉ ุงูุจูุงูุงุช:
- **RLS ููุนู** ุนูู ุงูุฌุฏูู
- **ุณูุงุณุงุช ูุญุฏุฏุฉ** ูููุฏูุฑูู ููุท
- **ุชุณุฌูู ุงูุนูููุงุช** (created_by, updated_by)

## ๐ ุงุณุชูุดุงู ุงูุฃุฎุทุงุก

### ูุดููุฉ: "ูุง ุชูุฌุฏ ุตูุงุญูุฉ ููุชุนุฏูู"
**ุงูุญู**: ุชุฃูุฏ ุฃู ุงููุณุชุฎุฏู ูู ุฏูุฑ `admin` ูู ุฌุฏูู `users`

### ูุดููุฉ: "ุฎุทุฃ ูู ุฌูุจ ุงูุฅุนุฏุงุฏุงุช"
**ุงูุญู**: 
1. ุชุญูู ูู ุงุชุตุงู ูุงุนุฏุฉ ุงูุจูุงูุงุช
2. ุชุฃูุฏ ูู ุชุดุบูู ุณูุฑูุจุช ุฅูุดุงุก ุงูุฌุฏูู
3. ุชุญูู ูู ุณูุงุณุงุช RLS

### ูุดููุฉ: "ุงูุฅุนุฏุงุฏุงุช ูุง ุชุธูุฑ"
**ุงูุญู**:
1. ูุณุญ ุงูุชุฎุฒูู ุงููุคูุช: `clearCompanySettingsCache()`
2. ุฅุนุงุฏุฉ ุชุญููู ุงูุตูุญุฉ
3. ุงูุชุญูู ูู ูุฌูุฏ ุจูุงูุงุช ูู ุงูุฌุฏูู

## ๐ ูุฑุงูุจุฉ ุงูุฃุฏุงุก

### ุงุณุชุนูุงูุงุช ูุฑุงูุจุฉ:
```sql
-- ุนุฏุฏ ุงูุชุญุฏูุซุงุช
SELECT COUNT(*) FROM company_settings;

-- ุขุฎุฑ ุชุญุฏูุซ
SELECT * FROM company_settings ORDER BY updated_at DESC LIMIT 1;

-- ุงููุณุชุฎุฏููู ุงูุฐูู ุนุฏููุง ุงูุฅุนุฏุงุฏุงุช
SELECT DISTINCT updated_by FROM company_settings;
```

## ๐ฏ ุงูููุฒุงุช ุงููุณุชูุจููุฉ

- [ ] **ุฅุตุฏุงุฑุงุช ุงูุฅุนุฏุงุฏุงุช** - ุญูุธ ุชุงุฑูุฎ ุงูุชุบููุฑุงุช
- [ ] **ุฅุนุฏุงุฏุงุช ูุชุนุฏุฏุฉ** - ุฏุนู ุดุฑูุงุช ูุชุนุฏุฏุฉ
- [ ] **ุชุตุฏูุฑ/ุงุณุชูุฑุงุฏ** - ูุณุฎ ุงุญุชูุงุทู ููุฅุนุฏุงุฏุงุช
- [ ] **ุฅุดุนุงุฑุงุช ุงูุชุบููุฑ** - ุฅุดุนุงุฑ ุงููุณุชุฎุฏููู ุจุงูุชุญุฏูุซุงุช

---

## โ ุงูุชุญูู ูู ุงูุฅุนุฏุงุฏ

ุจุนุฏ ุชุดุบูู ุงูุณูุฑูุจุชุ ุชุฃูุฏ ูู:

1. โ **ุงูุฌุฏูู ููุฌูุฏ**: `SELECT * FROM company_settings;`
2. โ **ุงูุฏูุงู ุชุนูู**: `SELECT * FROM get_company_settings();`
3. โ **ุงูุณูุงุณุงุช ููุนูุฉ**: `SELECT * FROM pg_policies WHERE tablename = 'company_settings';`
4. โ **ุงูุฅุนุฏุงุฏุงุช ุงูุงูุชุฑุงุถูุฉ ููุฌูุฏุฉ**: ูุฌุจ ุฃู ุชุฑู ุณุฌู ูุงุญุฏ
5. โ **ุงููุงุฌูุฉ ุชุนูู**: ุงุฐูุจ ุฅูู Settings โ Company Settings

**๐ ูุจุฑูู! ูุธุงู ุฅุนุฏุงุฏุงุช ุงูุดุฑูุฉ ุฌุงูุฒ ููุงุณุชุฎุฏุงู!**
